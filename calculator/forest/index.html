<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é­”å¥³æ£®æ—æŠ½å¥–</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* æ–°å¢ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .flex-row { flex-direction: column; }
            .section { margin: 10px 0; }
            button { width: 100%; margin: 5px 0; }
            input { width: 90% !important; }
            h1 { font-size: 1.5rem; }
            h3 { font-size: 1.2rem; }
            #chart { max-width: 95vw; }
            .rare-options { display: flex; flex-wrap: wrap; }
        }

        /* ä¼˜åŒ–åŸºç¡€æ ·å¼ */
        * { box-sizing: border-box; }
        
        body { 
            background: #2a0f47; 
            color: #fff; 
            font-family: Arial; 
            padding: 10px;
            line-height: 1.5;
        }

        .container { 
            max-width: 100%;
            margin: 0 auto;
            padding: 0 10px;
        }

        .section { 
            background: rgba(40, 40, 40, 0.9); 
            border: 1px solid #6272a4; 
            border-radius: 10px; 
            padding: 15px;
            margin: 10px 0;
        }

        .flex-row { 
            display: flex; 
            gap: 15px;
            flex-wrap: wrap;
        }

        input { 
            background: #44475a;
            border: 1px solid #6272a4;
            color: #fff;
            padding: 8px;
            margin: 5px 0;
            width: 100px;
            border-radius: 4px;
        }

        button { 
            background: #6272a4;
            color: #fff; 
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
            font-size: 1rem;
        }

        .history-list { 
            height: 150px;
            max-height: 30vh;
            overflow-y: auto; 
            border: 1px solid #6272a4; 
            padding: 10px;
            font-size: 0.9rem;
        }

        #progressBar { 
            width: 100%; 
            height: 20px; 
            background: #44475a; 
            border-radius: 10px; 
            overflow: hidden; 
            margin: 10px 0;
        }

        /* ä¿æŒåŸæœ‰ç‰¹æ•ˆä¸å˜ */
        .premium-item { color: #ffb86c; }
        .ss-item { color: #ff5555; animation: glow 1s infinite alternate; }
        @keyframes glow { 
            from { text-shadow: 0 0 5px #ff5555; } 
            to { text-shadow: 0 0 20px #ff5555; } 
        }
    </style>
    <!-- ç™¾åº¦ç»Ÿè®¡ä»£ç ä¿æŒä¸å˜ -->
    <script>
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?b52ffcdf33a044f844b6558bb382a915";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();
    </script>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: #ff79c6; margin: 15px 0;">ğŸƒ é­”å¥³æ£®æ—æŠ½å¥–æ¨¡æ‹Ÿ ğŸ„</h1>
        <div style="text-align: center; margin-bottom: 15px;">
            by ç´«ç”µNS 
            <a href="https://photonrain.github.io/" style="color: #3498db; text-decoration: none;">ç½‘ç«™é¦–é¡µ</a>
        </div>

        <div class="flex-row">
            <!-- é“å…·ä»·æ ¼è®¾ç½®åŒºå— -->
            <div class="section" style="flex:1">
                <h3>ğŸ”§ é“å…·ä»·æ ¼</h3>
                A: <input type="number" id="priceA" value="10"><br>
                A+: <input type="number" id="priceAplus" value="20"><br>
                AA: <input type="number" id="priceAA" value="50"><br>
                S: <input type="number" id="priceS" value="1000"><br>
                SS: <input type="number" id="priceSS" value="8000">
            </div>

            <!-- æŠ½å¥–æ§åˆ¶åŒºå— -->
            <div class="section" style="flex:2">
                <h3>ğŸ® æŠ½å¥–æ§åˆ¶</h3>
                å•æ¬¡ä»·æ ¼: <input type="number" id="cost" value="50">
                
                <div class="rare-options" style="margin: 15px 0;">
                    <label><input type="radio" name="rare" value="S" checked> æŠ½åˆ°Såœ</label>
                    <label><input type="radio" name="rare" value="SS"> æŠ½åˆ°SSåœ</label>
                    <label><input type="radio" name="rare" value="both"> æŠ½åˆ°S/SSåœ</label>
                </div>
                
                <div class="flex-row">
                    <button onclick="draw(1)">ğŸ”® å•æŠ½</button>
                    <button onclick="draw(10)">ğŸŒŸ åè¿</button>
                    <button onclick="draw(100)">âœ¨ ç™¾è¿</button>
                </div>
                <button onclick="startConditionalDraw()" style="margin-top:10px;">ğŸ’« æŠ½åˆ°æŒ‡å®šç¨€æœ‰åº¦</button>
                <button class="reset-btn" onclick="resetAll()" style="background:#ff5555; margin-top:10px;">ğŸ”„ é‡ç½®æ•°æ®</button>
            </div>
        </div>

        <!-- æ”¶ç›Šç»Ÿè®¡åŒºå— -->
        <div class="section">
            <h3>ğŸ“ˆ æ”¶ç›Šç»Ÿè®¡</h3>
            <div id="progressBar">
                <div id="progressFill" style="width: 50%"></div>
            </div>
            <div id="profitText" style="margin:10px 0;">å½“å‰æ”¶ç›Š: 0 é‡‘å¸</div>
            <div class="drawing-status" id="drawingStatus"></div>
        </div>

        <!-- å†å²è®°å½•åŒºå— -->
        <div class="flex-row">
            <div class="section" style="flex:1">
                <h3>ğŸ“œ æŠ½å¥–è®°å½•</h3>
                <div class="history-list" id="history"></div>
            </div>
            <div class="section" style="flex:1">
                <h3>ğŸ’ é«˜çº§é“å…·</h3>
                <div class="history-list" id="premiumHistory"></div>
            </div>
        </div>

        <!-- å›¾è¡¨åŒºå— -->
        <div class="section">
            <h3>ğŸ“Š é“å…·åˆ†å¸ƒ</h3>
            <div style="overflow-x: auto;">
                <canvas id="chart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // JavaScript ä»£ç ä¿æŒä¸å˜ï¼Œä¸åŸå§‹ç‰ˆæœ¬ä¸€è‡´
        let profit = 0;
        let history = [];
        let premiumHistory = [];
        let distribution = { A:0, Aplus:0, AA:0, S:0, SS:0 };
        let chart = null;
        let isDrawing = false;

        const probabilities = [
            { type: 'A', prob: 68.88 },
            { type: 'Aplus', prob: 23.8 },
            { type: 'AA', prob: 6.05 },
            { type: 'S', prob: 0.21 },
            { type: 'SS', prob: 0.06 },
        ];

        function getSelectedCondition() {
            const selected = document.querySelector('input[name="rare"]:checked').value;
            return {
                'S': (r) => r === 'S',
                'SS': (r) => r === 'SS',
                'both': (r) => r === 'S' || r === 'SS'
            }[selected];
        }

        function singleDraw() {
            const rand = Math.random() * 100;
            let cumulative = 0;
            let result = 'A';
            
            for(const {type, prob} of probabilities) {
                cumulative += prob;
                if(rand <= cumulative) {
                    result = type;
                    break;
                }
            }
            
            const value = getPrice(result);
            const cost = parseInt(document.getElementById('cost').value);
            
            distribution[result]++;
            history.unshift(`${result} (+${value})`);
            if(result === 'S' || result === 'SS') {
                premiumHistory.unshift(`â­ ${result} (+${value})`);
            }
            
            profit += value - cost;
            return result;
        }

        async function startConditionalDraw() {
            if(isDrawing) return;
            isDrawing = true;
            const condition = getSelectedCondition();
            const statusElement = document.getElementById('drawingStatus');
            let count = 0;
            const maxAttempts = 5000;
            
            statusElement.style.display = 'block';
            statusElement.textContent = "å‡†å¤‡æŠ½å¥–...";
            
            while(count < maxAttempts) {
                count++;
                const result = singleDraw();
                
                if(condition(result)) {
                    statusElement.innerHTML = `ğŸ‰ åœ¨ç¬¬ ${count} æ¬¡æŠ½ä¸­ ${result}ï¼`;
                    break;
                }
                
                if(count % 50 === 0) {
                    statusElement.textContent = `å·²å°è¯• ${count} æ¬¡...`;
                    await new Promise(resolve => setTimeout(resolve, 0));
                    updateUI();
                }
            }
            
            if(count >= maxAttempts) {
                statusElement.innerHTML = "âš ï¸ å·²è¾¾åˆ°å®‰å…¨é™åˆ¶ï¼ˆ5000æ¬¡ï¼‰ä»æœªæŠ½ä¸­";
            }
            
            updateUI();
            isDrawing = false;
        }

        function getPrice(type) {
            return parseInt(document.getElementById(`price${type}`).value);
        }

        function resetAll() {
            profit = 0;
            history = [];
            premiumHistory = [];
            distribution = { A:0, Aplus:0, AA:0, S:0, SS:0 };
            document.getElementById('priceA').value = 10;
            document.getElementById('priceAplus').value = 20;
            document.getElementById('priceAA').value = 50;
            document.getElementById('priceS').value = 1000;
            document.getElementById('priceSS').value = 8000;
            document.getElementById('cost').value = 50;
            updateUI();
        }

        function draw(times) {
            const cost = parseInt(document.getElementById('cost').value) * times;
            let totalGain = 0;
            
            for(let i=0; i<times; i++) {
                const result = singleDraw();
                totalGain += getPrice(result);
            }
            
            profit += totalGain - cost;
            updateUI();
        }

        function updateUI() {
            document.getElementById('profitText').innerHTML = 
                `å½“å‰æ”¶ç›Š: ${profit} é‡‘å¸ ${profit>=0?'â†‘':'â†“'}`;
            document.getElementById('progressFill').style.width = 
                `${Math.min(100, 50 + profit/100)}%`;

            document.getElementById('history').innerHTML = 
                history.slice(0,10).map(item => `<div>${item}</div>`).join('');
            document.getElementById('premiumHistory').innerHTML = 
                premiumHistory.slice(0,10).map(item => 
                    `<div class="${item.includes('SS')?'ss-item':'premium-item'}">${item}</div>`
                ).join('');

            if(chart) chart.destroy();
            const ctx = document.getElementById('chart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(distribution),
                    datasets: [{
                        data: Object.values(distribution),
                        backgroundColor: ['#6272a4', '#50fa7b', '#bd93f9', '#ffb86c', '#ff5555']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        updateUI();
    </script>
</body>
</html>
