<!DOCTYPE html>
<html lang="zh-CN">
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b52ffcdf33a045f844b6558bb382a915";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta charset="UTF-8">
    <title>å†’é™©å²›æ˜Ÿä¹‹åŠ›å¼ºåŒ–æ¨¡æ‹Ÿå™¨</title>
	
    <style>
			.probability-table {
			width: 100%;
			border-collapse: collapse;
			margin: 20px 0;
			background: white;
			border-radius: 12px;
			overflow: hidden;
			box-shadow: 0 2px 8px rgba(0,0,0,0.1);
		}

		.probability-table th {
			background: linear-gradient(135deg, var(--primary), #1976D2);
			color: white;
			padding: 16px;
			font-weight: 600;
			text-align: center;
		}

		.probability-table td {
			padding: 14px;
			text-align: center;
			border-bottom: 1px solid #f0f0f0;
		}

		.probability-table tr:nth-child(even) {
			background-color: #f8f9fa;
		}

		.probability-table tr:hover {
			background-color: #f1f8ff;
		}

		/* é¢œè‰²æ ‡è¯† */
		.success-rate { color: #4CAF50; font-weight: 600; }
		.failure-rate { color: #f44336; font-weight: 600; }
		.destroy-rate { color: #9C27B0; font-weight: 600; }

		/* å“åº”å¼å¤„ç† */
		@media (max-width: 768px) {
			.probability-table {
				display: block;
				overflow-x: auto;
			}
		}
        :root {
            --primary: #2196F3;
            --secondary: #FF9800;
            --background: #f5f5f5;
            --text: #333;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--background);
            margin: 0;
            padding: 20px;
            color: var(--text);
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.08);
            padding: 30px;
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .control-group {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
        }

        .control-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            color: #2c3e50;
        }

        select, input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        select:focus, input[type="number"]:focus {
            border-color: var(--primary);
            outline: none;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
        }

        button {
            background: linear-gradient(135deg, var(--primary), #1976D2);
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #stopButton {
            background: linear-gradient(135deg, #ff5722, #f4511e);
        }

        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            opacity: 0.7;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .results-panel {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-top: 30px;
        }

        .stats-card {
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
        }

        .stat-item {
            margin: 20px 0;
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
        }

        .stat-value {
            color: var(--primary);
            font-weight: 700;
            font-size: 1.2em;
        }

        .histogram {
            padding: 20px;
            background: white;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
        }

        .bar-container {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bar-label {
            width: 100px;
            text-align: right;
            font-weight: 500;
        }

        .bar {
            height: 35px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 6px;
            transition: width 0.5s ease-out;
            display: flex;
            align-items: center;
            padding: 0 15px;
            color: white;
            font-weight: 600;
            min-width: 50px;
        }

        h2 {
            color: var(--text);
            margin-top: 0;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
        }
		.stats-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* 2åˆ—å¸ƒå±€ */
    gap: 20px;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.stats-section {
    background: #fff;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    height: 400px; /* å›ºå®šé«˜åº¦ */
}

.stats-section h3 {
    margin: 0 0 10px 0;
    font-size: 16px;
}

.stats-section canvas {
    max-height: 280px !important; /* é™åˆ¶å›¾è¡¨é«˜åº¦ */
    width: 100% !important;
}

.stats-summary {
    margin-top: 10px;
    font-size: 14px;
}

.stats-summary p {
    margin: 5px 0;
}


    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; margin-bottom: 30px;">ğŸŒŸ æ˜Ÿä¹‹åŠ›å¼ºåŒ–æ¨¡æ‹Ÿå™¨</h1>
		<h6 style="text-align: center; margin-bottom: 5px;">    by ç´«ç”µNS 
    <a href="https://photonrain.github.io/" class="ms-3" style="color: #3498db; text-decoration: none;">ç½‘ç«™é¦–é¡µ</a>
	<h6 style="text-align: center; margin-bottom: 5px;">25æ˜Ÿä¸ºå›½æœå®é™…æƒ…å†µï¼›30æ˜Ÿä¸ºéŸ©æœé­”æ”¹ç»“æœï¼šé¢å¤–å¢åŠ æ‰æ˜Ÿã€æŸåç‡(åŒå€)ï¼Œå¿«æ¥æŒ‘æˆ˜ä¸€ä¸‹å§:D</h6>
</h6>
<h5 class="text-center mb-4">
        
        <div class="control-panel">
            <div class="control-group">
                <label>âš™ï¸ å¼ºåŒ–è§„åˆ™</label>
                <div style="display: grid; gap: 15px;">
                    <div>
                        <label>æ˜Ÿæ˜Ÿä¸Šé™ï¼š</label>
                        <select id="maxStars">
                            <option value="25">25æ˜Ÿ</option>
                            <option value="30">30æ˜Ÿ</option>
							<option value="40">30æ˜Ÿ(éŸ©æœ)</option>
                        </select>
                    </div>
                    <div>
                        <label>å½“å‰æ˜Ÿæ˜Ÿæ•°ï¼š</label>
                        <input type="number" id="currentStars" min="0" max="25" value="15">
                    </div>
                    <div>
                        <label>ç›®æ ‡æ˜Ÿæ•°ï¼š</label>
                        <input type="number" id="targetStars" placeholder="è¾“å…¥ç›®æ ‡æ˜Ÿæ•°" min="0" max="25">
                    </div>
                    <div>
                        <label>æŸååæ˜Ÿæ•°ï¼š</label>
                        <input type="number" id="destroyedStars" min="0" max="30" value="6">
                    </div>
                </div>

                <div style="display: grid; gap: 10px; margin-top: 15px;">
					<label>
						<input type="checkbox" id="sundayMode"> å‘¨æ—¥å¿…æˆæ¨¡å¼ï¼ˆ5-6ï¼Œ10-11ï¼Œ15-16ï¼‰
					</label>
					<label>
						<input type="checkbox" id="antiExplode"> é˜²çˆ†å·è½´ï¼ˆ12-16é˜²çˆ†ï¼‰
					</label>
					<label>
						<input type="checkbox" id="noDrop"> ä¸æ‰æ˜Ÿæ¨¡å¼
					</label>
					<label>
						<input type="checkbox" id="rapidMode"> æ€¥é€Ÿæ¨¡å¼
					</label>
				</div>
            </div>

            
        </div>

        <div class="button-group">
            <button id="startButton" onclick="startSimulation()">ğŸš€ å¼€å§‹å¼ºåŒ–</button>
            <button id="stopButton" onclick="stopSimulation()" disabled>â¹ åœæ­¢æ¨¡æ‹Ÿ</button>
			  <button id="statsButton">ç»Ÿè®¡æ¨¡æ‹Ÿ</button>
        </div>

        <div class="results-panel">
            <div class="stats-card">
                <h2>ğŸ“Š ç»Ÿè®¡ç»“æœ</h2>
                <div class="stat-item">
                    <span>å½“å‰æ˜Ÿæ•°ï¼š</span>
                    <span class="stat-value" id="finalStars">-</span>
                </div>
                <div class="stat-item">
                    <span>å°è¯•æ¬¡æ•°ï¼š</span>
                    <span class="stat-value" id="attempts">0</span>
                </div>
                <div class="stat-item">
                    <span>è£…å¤‡æŸåï¼š</span>
                    <span class="stat-value" id="destroys">0</span>
                </div>
            </div>

            <div class="histogram">
                <h2>ğŸ“ˆ æ˜Ÿæ•°åˆ†å¸ƒ</h2>
                <div id="chart"></div>
            </div>
        </div>
    </div>
	<div id="statsResults" style="display: none;">
    <h2>ç»Ÿè®¡æ¨¡æ‹Ÿç»“æœ (10000æ¬¡)</h2>
    <div class="stats-container">
        <div class="stats-section">
            <h3>å°è¯•æ¬¡æ•°åˆ†å¸ƒ</h3>
            <canvas id="attemptsChart"></canvas>
            <div class="stats-summary">
                <p>å¹³å‡å°è¯•æ¬¡æ•°: <span id="avgAttempts">0</span></p>
                <p>æœ€å°å°è¯•æ¬¡æ•°: <span id="minAttempts">0</span></p>
                <p>æœ€å¤§å°è¯•æ¬¡æ•°: <span id="maxAttempts">0</span></p>
            </div>
        </div>
		<div class="stats-section">
    <h3>å°è¯•æ¬¡æ•°ç´¯è®¡æ¦‚ç‡åˆ†å¸ƒ</h3>
    <canvas id="cumulativeChart"></canvas>
    <div class="stats-summary">
        <p>50%æ¦‚ç‡å®Œæˆæ‰€éœ€æ¬¡æ•°: <span id="median">0</span></p>
        <p>90%æ¦‚ç‡å®Œæˆæ‰€éœ€æ¬¡æ•°: <span id="percentile90">0</span></p>
        <p>95%æ¦‚ç‡å®Œæˆæ‰€éœ€æ¬¡æ•°: <span id="percentile95">0</span></p>
    </div>
</div>

        
        <div class="stats-section">
            <h3>æŸåæ¬¡æ•°åˆ†å¸ƒ</h3>
            <canvas id="destroyChart"></canvas>
            <div class="stats-summary">
                <p>å¹³å‡æŸåæ¬¡æ•°: <span id="avgDestroys">0</span></p>
                <p>æœ€å°æŸåæ¬¡æ•°: <span id="minDestroys">0</span></p>
                <p>æœ€å¤§æŸåæ¬¡æ•°: <span id="maxDestroys">0</span></p>
            </div>
        </div>

        <div class="stats-section">
            <h3>æ˜Ÿæ˜Ÿåˆ°è¾¾é¢‘ç‡åˆ†å¸ƒ</h3>
            <canvas id="starsReachedChart"></canvas>
        </div>
		
    </div>
</div>
	<div class="control-group">
				<label>ğŸ“œ æ˜Ÿä¹‹åŠ›æ¦‚ç‡è¡¨</label>
				<div id="probabilityTable" style="margin-top: 10px;"></div>
			</div>
    <script>
		const probabilityData = {
			25: [
				{ stars: "0â†’1",  success: 85,  failure: 15,  destroy: 0,   drops: false },
				{ stars: "1â†’2",  success: 80,  failure: 20,  destroy: 0,   drops: false },
				{ stars: "2â†’3",  success: 75,  failure: 25,  destroy: 0,   drops: false },
				{ stars: "3â†’4",  success: 75,  failure: 25,  destroy: 0,   drops: false },
				{ stars: "4â†’5",  success: 70,  failure: 30,  destroy: 0,   drops: false },
				{ stars: "5â†’6",  success: 65,  failure: 35,  destroy: 0,   drops: false },
				{ stars: "6â†’7",  success: 60,  failure: 40,  destroy: 0,   drops: false },
				{ stars: "7â†’8",  success: 55,  failure: 45,  destroy: 0,   drops: false },
				{ stars: "8â†’9",  success: 50,  failure: 50,  destroy: 0,   drops: false },
				{ stars: "9â†’10", success: 45,  failure: 55,  destroy: 0,   drops: false },
				{ stars: "10â†’11",success: 40,  failure: 60,  destroy: 0,   drops: false },
				{ stars: "11â†’12",success: 30,  failure: 68.6,destroy: 1.4, drops: true  },
				{ stars: "12â†’13",success: 25,  failure: 72.7,destroy: 2.3, drops: true  },
				{ stars: "13â†’14",success: 25,  failure: 72,  destroy: 3,   drops: true  },
				{ stars: "14â†’15",success: 20,  failure: 76,  destroy: 4,   drops: true  },
				{ stars: "15â†’16",success: 20,  failure: 75.2,destroy: 4.8, drops: false },
				{ stars: "16â†’17",success: 20,  failure: 74.4,destroy: 5.6, drops: true  },
				{ stars: "17â†’18",success: 20,  failure: 73.6,destroy: 6.4, drops: true  },
				{ stars: "18â†’19",success: 15,  failure: 77.3,destroy: 7.7, drops: true  },
				{ stars: "19â†’20",success: 15,  failure: 76.5,destroy: 8.5, drops: true  },
				{ stars: "20â†’21",success: 15,  failure: 74.8,destroy: 10.2,drops: false },
				{ stars: "21â†’22",success: 10,  failure: 76.5,destroy: 13.5,drops: true  },
				{ stars: "22â†’23",success: 3,   failure: 77.6,destroy: 19.4,drops: true  },
				{ stars: "23â†’24",success: 2,   failure: 68.6,destroy: 29.4,drops: true  },
				{ stars: "24â†’25",success: 1,   failure: 59.4,destroy: 39.6,drops: true  }
			],
			30: [
				{ stars: "0â†’1",  success: 85,  failure: 15,  destroy: 0,   drops: false },
				{ stars: "1â†’2",  success: 80,  failure: 20,  destroy: 0,   drops: false },
				{ stars: "2â†’3",  success: 75,  failure: 25,  destroy: 0,   drops: false },
				{ stars: "3â†’4",  success: 75,  failure: 25,  destroy: 0,   drops: false },
				{ stars: "4â†’5",  success: 70,  failure: 30,  destroy: 0,   drops: false },
				{ stars: "5â†’6",  success: 65,  failure: 35,  destroy: 0,   drops: false },
				{ stars: "6â†’7",  success: 60,  failure: 40,  destroy: 0,   drops: false },
				{ stars: "7â†’8",  success: 55,  failure: 45,  destroy: 0,   drops: false },
				{ stars: "8â†’9",  success: 50,  failure: 50,  destroy: 0,   drops: false },
				{ stars: "9â†’10", success: 45,  failure: 55,  destroy: 0,   drops: false },
				{ stars: "10â†’11",success: 40,  failure: 60,  destroy: 0,   drops: false },
				{ stars: "11â†’12",success: 30,  failure: 68.6,destroy: 1.4, drops: true  },
				{ stars: "12â†’13",success: 25,  failure: 72.7,destroy: 2.3, drops: true  },
				{ stars: "13â†’14",success: 25,  failure: 72,  destroy: 3,   drops: true  },
				{ stars: "14â†’15",success: 20,  failure: 76,  destroy: 4,   drops: true  },
				{ stars: "15â†’16",success: 20,  failure: 74.96,destroy:5.04,drops: false },
				{ stars: "16â†’17",success: 20,  failure: 74.96,destroy:5.04,drops: true  },
				{ stars: "17â†’18",success: 20,  failure: 63.68,destroy:16.32,drops:true  },
				{ stars: "18â†’19",success: 15,  failure: 68.68,destroy:16.32,drops:true  },
				{ stars: "19â†’20",success: 15,  failure: 64.6,destroy:20.4, drops: true  },
				{ stars: "20â†’21",success: 15,  failure: 59.8,destroy:25.2, drops: false },
				{ stars: "21â†’22",success: 10,  failure: 59.4,destroy:30.6, drops: true  },
				{ stars: "22â†’23",success: 10,  failure: 49.2,destroy:40.8, drops: true  },
				{ stars: "23â†’24",success: 10,  failure: 46.8,destroy:43.2, drops: true  },
				{ stars: "24â†’25",success: 10,  failure: 46.8,destroy:43.2, drops: true  },
				{ stars: "25â†’26",success: 9,   failure: 47.8,destroy:43.2, drops: true  },
				{ stars: "26â†’27",success: 7,   failure: 48.36,destroy:44.64,drops:true  },
				{ stars: "27â†’28",success: 5,   failure: 49.4,destroy:45.6, drops: true  },
				{ stars: "28â†’29",success: 3,   failure: 50.44,destroy:46.56,drops:true  },
				{ stars: "29â†’30",success: 1,   failure: 51.48,destroy:47.52,drops:true  }
			],
			40: [
				{ stars: "0â†’1",   success: 95,  failure: 5,    destroy: 0,    drops: false },
				{ stars: "1â†’2",   success: 90,  failure: 10,   destroy: 0,    drops: false },
				{ stars: "2â†’3",   success: 85,  failure: 15,   destroy: 0,    drops: false },
				{ stars: "3â†’4",   success: 85,  failure: 15,   destroy: 0,    drops: false },
				{ stars: "4â†’5",   success: 80,  failure: 20,   destroy: 0,    drops: false },
				{ stars: "5â†’6",   success: 75,  failure: 25,   destroy: 0,    drops: false },
				{ stars: "6â†’7",   success: 70,  failure: 30,   destroy: 0,    drops: false },
				{ stars: "7â†’8",   success: 65,  failure: 35,   destroy: 0,    drops: false },
				{ stars: "8â†’9",   success: 60,  failure: 40,   destroy: 0,    drops: false },
				{ stars: "9â†’10",  success: 55,  failure: 45,   destroy: 0,    drops: false },
				{ stars: "10â†’11", success: 50,  failure: 50,   destroy: 0,    drops: false },
				{ stars: "11â†’12", success: 45,  failure: 55,   destroy: 0,    drops: false },
				{ stars: "12â†’13", success: 40,  failure: 60,   destroy: 0,    drops: false },
				{ stars: "13â†’14", success: 35,  failure: 65,   destroy: 0,    drops: false },
				{ stars: "14â†’15", success: 30,  failure: 70,   destroy: 0,    drops: false },
				{ stars: "15â†’16", success: 30,  failure: 67.9,  destroy: 2.1,  drops: false },
				{ stars: "16â†’17", success: 30,  failure: 67.9,  destroy: 2.1,  drops: false },
				{ stars: "17â†’18", success: 15,  failure: 78.2,  destroy: 6.8,  drops: false },
				{ stars: "18â†’19", success: 15,  failure: 78.2,  destroy: 6.8,  drops: false },
				{ stars: "19â†’20", success: 15,  failure: 76.5,  destroy: 8.5,  drops: false },
				{ stars: "20â†’21", success: 30,  failure: 59.5,  destroy: 10.5, drops: false },
				{ stars: "21â†’22", success: 15,  failure: 72.25, destroy: 12.75,drops: false },
				{ stars: "22â†’23", success: 15,  failure: 68,    destroy: 17,   drops: false },
				{ stars: "23â†’24", success: 10,  failure: 72,    destroy: 18,   drops: false },
				{ stars: "24â†’25", success: 10,  failure: 72,    destroy: 18,   drops: false },
				{ stars: "25â†’26", success: 10,  failure: 72,    destroy: 18,   drops: false },
				{ stars: "26â†’27", success: 7,   failure: 74.4,  destroy: 18.6, drops: false },
				{ stars: "27â†’28", success: 5,   failure: 76,    destroy: 19,   drops: false },
				{ stars: "28â†’29", success: 3,   failure: 77.6,  destroy: 19.4, drops: false },
				{ stars: "29â†’30", success: 1,   failure: 79.2,  destroy: 19.8, drops: false }
			]
		};

        const probabilityTable = {
            25: {
                0:  { success: 0.85,  failure: 0.15,   destroy: 0.000, failureDrops: false },
                1:  { success: 0.80,  failure: 0.20,   destroy: 0.000, failureDrops: false },
                2:  { success: 0.75,  failure: 0.25,   destroy: 0.000, failureDrops: false },
                3:  { success: 0.75,  failure: 0.25,   destroy: 0.000, failureDrops: false },
                4:  { success: 0.70,  failure: 0.30,   destroy: 0.000, failureDrops: false },
                5:  { success: 0.65,  failure: 0.35,   destroy: 0.000, failureDrops: false },
                6:  { success: 0.60,  failure: 0.40,   destroy: 0.000, failureDrops: false },
                7:  { success: 0.55,  failure: 0.45,   destroy: 0.000, failureDrops: false },
                8:  { success: 0.50,  failure: 0.50,   destroy: 0.000, failureDrops: false },
                9:  { success: 0.45,  failure: 0.55,   destroy: 0.000, failureDrops: false },
                10: { success: 0.40,  failure: 0.60,   destroy: 0.000, failureDrops: false },
                11: { success: 0.30,  failure: 0.686,  destroy: 0.014, failureDrops: true },
                12: { success: 0.25,  failure: 0.727,  destroy: 0.023, failureDrops: true },
                13: { success: 0.25,  failure: 0.72,   destroy: 0.030, failureDrops: true },
                14: { success: 0.20,  failure: 0.76,   destroy: 0.040, failureDrops: true },
                15: { success: 0.20,  failure: 0.752,  destroy: 0.048, failureDrops: false },
                16: { success: 0.20,  failure: 0.744,  destroy: 0.056, failureDrops: true },
                17: { success: 0.20,  failure: 0.736,  destroy: 0.064, failureDrops: true },
                18: { success: 0.15,  failure: 0.773,  destroy: 0.077, failureDrops: true },
                19: { success: 0.15,  failure: 0.765,  destroy: 0.085, failureDrops: true },
                20: { success: 0.15,  failure: 0.748,  destroy: 0.102, failureDrops: false },
                21: { success: 0.10,  failure: 0.765,  destroy: 0.135, failureDrops: true },
                22: { success: 0.03,  failure: 0.776,  destroy: 0.194, failureDrops: true },
                23: { success: 0.02,  failure: 0.686,  destroy: 0.294, failureDrops: true },
                24: { success: 0.01,  failure: 0.594,  destroy: 0.396, failureDrops: true }
            },
            30: {
			0:  { success: 0.85,  failure: 0.15,   destroy: 0.000, failureDrops: false },
			1:  { success: 0.80,  failure: 0.20,   destroy: 0.000, failureDrops: false },
			2:  { success: 0.75,  failure: 0.25,   destroy: 0.000, failureDrops: false },
			3:  { success: 0.75,  failure: 0.25,   destroy: 0.000, failureDrops: false },
			4:  { success: 0.70,  failure: 0.30,   destroy: 0.000, failureDrops: false },
			5:  { success: 0.65,  failure: 0.35,   destroy: 0.000, failureDrops: false },
			6:  { success: 0.60,  failure: 0.40,   destroy: 0.000, failureDrops: false },
			7:  { success: 0.55,  failure: 0.45,   destroy: 0.000, failureDrops: false },
			8:  { success: 0.50,  failure: 0.50,   destroy: 0.000, failureDrops: false },
			9:  { success: 0.45,  failure: 0.55,   destroy: 0.000, failureDrops: false },
			10: { success: 0.40,  failure: 0.60,   destroy: 0.000, failureDrops: false },
			11: { success: 0.30,  failure: 0.686,  destroy: 0.014, failureDrops: true  },
			12: { success: 0.25,  failure: 0.727,  destroy: 0.023, failureDrops: true  },
			13: { success: 0.25,  failure: 0.72,   destroy: 0.030, failureDrops: true  },
			14: { success: 0.20,  failure: 0.76,   destroy: 0.040, failureDrops: true  },
			15: { success: 0.20,  failure: 0.7496, destroy: 0.0504,failureDrops: false },
			16: { success: 0.20,  failure: 0.7496, destroy: 0.0504,failureDrops: true  },
			17: { success: 0.20,  failure: 0.6368, destroy: 0.1632,failureDrops: true  },
			18: { success: 0.15,  failure: 0.6868, destroy: 0.1632,failureDrops: true  },
			19: { success: 0.15,  failure: 0.646,  destroy: 0.204, failureDrops: true  },
			20: { success: 0.15,  failure: 0.598,  destroy: 0.252, failureDrops: false },
			21: { success: 0.10,  failure: 0.594,  destroy: 0.306, failureDrops: true  },
			22: { success: 0.10,  failure: 0.492,  destroy: 0.408, failureDrops: true  },
			23: { success: 0.10,  failure: 0.468,  destroy: 0.432, failureDrops: true  },
			24: { success: 0.10,  failure: 0.468,  destroy: 0.432, failureDrops: true  },
			25: { success: 0.09,failure: 0.478, destroy: 0.432, failureDrops: true  },
			26: { success: 0.07,failure: 0.4836,destroy: 0.4464,failureDrops: true  },
			27: { success: 0.05,failure: 0.494, destroy: 0.456, failureDrops: true  },
			28: { success: 0.03,failure: 0.5044,destroy: 0.4656,failureDrops: true  },
			29: { success: 0.01,failure: 0.5148,destroy: 0.4752,failureDrops: true  }
		},
			40: {
			0:  { success: 0.95,  failure: 0.05,    destroy: 0.000, failureDrops: false },
			1:  { success: 0.90,  failure: 0.10,    destroy: 0.000, failureDrops: false },
			2:  { success: 0.85,  failure: 0.15,    destroy: 0.000, failureDrops: false },
			3:  { success: 0.85,  failure: 0.15,    destroy: 0.000, failureDrops: false },
			4:  { success: 0.80,  failure: 0.20,    destroy: 0.000, failureDrops: false },
			5:  { success: 0.75,  failure: 0.25,    destroy: 0.000, failureDrops: false },
			6:  { success: 0.70,  failure: 0.30,    destroy: 0.000, failureDrops: false },
			7:  { success: 0.65,  failure: 0.35,    destroy: 0.000, failureDrops: false },
			8:  { success: 0.60,  failure: 0.40,    destroy: 0.000, failureDrops: false },
			9:  { success: 0.55,  failure: 0.45,    destroy: 0.000, failureDrops: false },
			10: { success: 0.50,  failure: 0.50,    destroy: 0.000, failureDrops: false },
			11: { success: 0.45,  failure: 0.55,    destroy: 0.000, failureDrops: false },
			12: { success: 0.40,  failure: 0.60,    destroy: 0.000, failureDrops: false },
			13: { success: 0.35,  failure: 0.65,    destroy: 0.000, failureDrops: false },
			14: { success: 0.30,  failure: 0.70,    destroy: 0.000, failureDrops: false },
			15: { success: 0.30,  failure: 0.679,   destroy: 0.021, failureDrops: false },
			16: { success: 0.30,  failure: 0.679,   destroy: 0.021, failureDrops: false },
			17: { success: 0.15,  failure: 0.782,   destroy: 0.068, failureDrops: false },
			18: { success: 0.15,  failure: 0.782,   destroy: 0.068, failureDrops: false },
			19: { success: 0.15,  failure: 0.765,   destroy: 0.085, failureDrops: false },
			20: { success: 0.30,  failure: 0.595,   destroy: 0.105, failureDrops: false },
			21: { success: 0.15,  failure: 0.7225,  destroy: 0.1275,failureDrops: false },
			22: { success: 0.15,  failure: 0.68,    destroy: 0.17,  failureDrops: false },
			23: { success: 0.10,  failure: 0.72,    destroy: 0.18,  failureDrops: false },
			24: { success: 0.10,  failure: 0.72,    destroy: 0.18,  failureDrops: false },
			25: { success: 0.10,  failure: 0.72,    destroy: 0.18,  failureDrops: false },
			26: { success: 0.07,  failure: 0.744,   destroy: 0.186, failureDrops: false },
			27: { success: 0.05,  failure: 0.76,    destroy: 0.19,  failureDrops: false },
			28: { success: 0.03,  failure: 0.776,   destroy: 0.194, failureDrops: false },
			29: { success: 0.01,  failure: 0.792,   destroy: 0.198, failureDrops: false }
		}
        };

        let simulationInterval = null;
        let simulationRunning = false;

        function getCurrentProb(stars, maxStars) {
            const original = probabilityTable[maxStars][stars];
            const cloned = {...original};

            // å‘¨æ—¥æ¨¡å¼
            if(document.getElementById('sundayMode').checked) {
                const specialStars = [5, 10, 15];
                if(specialStars.includes(stars)) {
                    cloned.success = 1;
                    cloned.failure = 0;
                    cloned.destroy = 0;
                }
            }

            // é˜²çˆ†æ¨¡å¼
            if(document.getElementById('antiExplode').checked && stars >= 12 && stars <= 16) {
                cloned.failure += cloned.destroy;
                cloned.destroy = 0;
            }

            return cloned;
        }
		
        function stopSimulation() {
            clearInterval(simulationInterval);
            simulationRunning = false;
            document.getElementById('startButton').disabled = false;
            document.getElementById('stopButton').disabled = true;
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('maxStars').addEventListener('change', function() {
            const max = parseInt(this.value);
            document.getElementById('currentStars').max = max;
            document.getElementById('targetStars').max = max;
            document.getElementById('destroyedStars').max = max;
        });

        document.querySelectorAll('input[type="checkbox"], input[type="number"]').forEach(input => {
            input.addEventListener('change', updateCurrentProbDisplay);
        });

        function updateCurrentProbDisplay() {
            const currentStars = parseInt(document.getElementById('currentStars').value);
            const maxStars = parseInt(document.getElementById('maxStars').value);
            const prob = getCurrentProb(currentStars, maxStars);
            updateProbabilityDisplay(prob, probabilityTable[maxStars][currentStars].failureDrops);
        }

        function updateProbabilityDisplay(prob, originalDrop) {
            const format = num => `${(num * 100).toFixed(1)}%`;
            
            document.getElementById('currentSuccess').textContent = format(prob.success);
            document.getElementById('currentFailure').textContent = format(prob.failure);
            document.getElementById('currentDestroy').textContent = format(prob.destroy);
            document.getElementById('currentDrop').textContent = 
                document.getElementById('noDrop').checked ? 'å¦' : (originalDrop ? 'æ˜¯' : 'å¦');
        }
		
        function startSimulation() {
				if (simulationRunning) return;
				
				const config = {
					maxStars: parseInt(document.getElementById('maxStars').value),
					currentStars: Math.min(
						parseInt(document.getElementById('currentStars').value),
						parseInt(document.getElementById('maxStars').value)
					),
					targetStars: parseInt(document.getElementById('targetStars').value) || 
							   parseInt(document.getElementById('maxStars').value),
					destroyedStars: Math.min(
						parseInt(document.getElementById('destroyedStars').value),
						parseInt(document.getElementById('maxStars').value)
					)
				};

				let state = {
					stars: config.currentStars,
					attempts: 0,
					destroys: 0,
					histogram: {}
				};

				simulationRunning = true;
				document.getElementById('startButton').disabled = true;
				document.getElementById('stopButton').disabled = false;
				const maxAttempts = 100000000;
				
				const isRapidMode = document.getElementById('rapidMode').checked;

				if (isRapidMode) {
					// æ€¥é€Ÿæ¨¡å¼ï¼šç›´æ¥è®¡ç®—åˆ°ç»“æŸ
					while (state.stars < config.targetStars && state.attempts < maxAttempts) {
						simulateStep(state, config);
					}
					updateResults(state);
					stopSimulation();
				} else {
					// æ™®é€šæ¨¡å¼ï¼šé€æ­¥è®¡ç®—å¹¶æ›´æ–°
					simulationInterval = setInterval(() => {
						if (state.stars >= config.targetStars || state.attempts >= maxAttempts) {
							stopSimulation();
							return;
						}
						simulateStep(state, config);
						updateResults(state);
					}, 0.0001);
				}
			}

        function simulateStep(state, config) {
            state.attempts++;
            const originalProb = probabilityTable[config.maxStars][state.stars];
            let prob = getCurrentProb(state.stars, config.maxStars);

            const rand = Math.random();
            
            if (rand < prob.success) {
                state.stars++;
            } else if (rand < prob.success + prob.failure) {
                if (!document.getElementById('noDrop').checked && originalProb.failureDrops) {
                    state.stars = Math.max(0, state.stars - 1);
                }
            } else {
                state.stars = config.destroyedStars;
                state.destroys++;
            }

            state.histogram[state.stars] = (state.histogram[state.stars] || 0) + 1;
        }

        function updateResults(state) {
            document.getElementById('finalStars').textContent = state.stars;
            document.getElementById('attempts').textContent = state.attempts.toLocaleString();
            document.getElementById('destroys').textContent = state.destroys.toLocaleString();

            const chart = document.getElementById('chart');
            chart.innerHTML = '';
            
            const entries = Object.entries(state.histogram)
                .sort((a, b) => b[0] - a[0]);
            const maxCount = Math.max(...entries.map(e => e[1]), 1);
            
            entries.forEach(([stars, count]) => {
                const container = document.createElement('div');
                container.className = 'bar-container';
                
                const label = document.createElement('div');
                label.className = 'bar-label';
                label.innerHTML = `
                    <div>${stars} æ˜Ÿ</div>
                    <div style="font-size: 0.9em; color: #666;">${count.toLocaleString()} æ¬¡</div>
                `;
                
                const bar = document.createElement('div');
                bar.className = 'bar';
                const percentage = (count / state.attempts * 100).toFixed(1);
                bar.style.width = `calc(${(count / maxCount * 100).toFixed(2)}% - 110px)`;
                bar.textContent = `${percentage}%`;
                
                container.appendChild(label);
                container.appendChild(bar);
                chart.appendChild(container);
            });
        }
		
		// æ·»åŠ ç»Ÿè®¡æ¨¡æ‹Ÿç›¸å…³å‡½æ•°
function runStatisticalSimulation() {
    const config = {
        maxStars: parseInt(document.getElementById('maxStars').value),
        currentStars: parseInt(document.getElementById('currentStars').value),
        targetStars: parseInt(document.getElementById('targetStars').value),
        destroyedStars: parseInt(document.getElementById('destroyedStars').value)
    };

    const results = [];
    const starsReached = new Array(config.maxStars + 1).fill(0);
    
    // è¿è¡Œ1000æ¬¡æ¨¡æ‹Ÿ
    for(let i = 0; i < 10000; i++) {
        let result = simulateToTarget(config);
        results.push(result);
        
        // æ›´æ–°åˆ°è¾¾é¢‘ç‡
        result.starsReached.forEach((count, star) => {
            starsReached[star] += count;
        });
    }

    // å¤„ç†ç»Ÿè®¡æ•°æ®
    const attemptStats = {
        values: results.map(r => r.attempts),
        avg: average(results.map(r => r.attempts)),
        min: Math.min(...results.map(r => r.attempts)),
        max: Math.max(...results.map(r => r.attempts))
    };

    const destroyStats = {
        values: results.map(r => r.destroys),
        avg: average(results.map(r => r.destroys)),
        min: Math.min(...results.map(r => r.destroys)),
        max: Math.max(...results.map(r => r.destroys))
    };

    // æ˜¾ç¤ºç»“æœ
    document.getElementById('statsResults').style.display = 'block';
    updateStatsDisplay(attemptStats, destroyStats, starsReached);
}

function simulateToTarget(config) {
    let stars = config.currentStars;
    let attempts = 0;
    let destroys = 0;
    let starsReached = new Array(config.maxStars + 1).fill(0);

    while(stars < config.targetStars) {
        attempts++;
        starsReached[stars]++;
        
        const prob = getCurrentProb(stars, config.maxStars);
        const rand = Math.random();
        
        if(rand < prob.success) {
            stars++;
        } else if(rand < prob.success + prob.failure) {
            if(!document.getElementById('noDrop').checked && 
               probabilityTable[config.maxStars][stars].failureDrops) {
                stars = Math.max(0, stars - 1);
            }
        } else {
            stars = config.destroyedStars;
            destroys++;
        }
    }

    return {attempts, destroys, starsReached};
}

function average(arr) {
    return arr.reduce((a, b) => a + b, 0) / arr.length;
}

function updateStatsDisplay(attemptStats, destroyStats, starsReached) {
    // æ›´æ–°æ•°å€¼ç»Ÿè®¡
    document.getElementById('avgAttempts').textContent = Math.round(attemptStats.avg);
    document.getElementById('minAttempts').textContent = attemptStats.min;
    document.getElementById('maxAttempts').textContent = attemptStats.max;
    
    document.getElementById('avgDestroys').textContent = destroyStats.avg;
    document.getElementById('minDestroys').textContent = destroyStats.min;
    document.getElementById('maxDestroys').textContent = destroyStats.max;

    // ç»˜åˆ¶åˆ†å¸ƒå›¾
    drawDistributionChart('attemptsChart', attemptStats.values, 'å°è¯•æ¬¡æ•°åˆ†å¸ƒ');
    drawDistributionChart('destroyChart', destroyStats.values, 'æŸåæ¬¡æ•°åˆ†å¸ƒ');
    drawStarsReachedChart('starsReachedChart', starsReached);
	drawCumulativeChart('cumulativeChart', attemptStats.values);
}

function drawDistributionChart(elementId, data, title) {
    // è®¡ç®—binçš„å¤§å°å’ŒèŒƒå›´
    const binSize = Math.ceil((Math.max(...data) - Math.min(...data)) / 20); // å°†èŒƒå›´åˆ†æˆçº¦20ä¸ªbin
    const minValue = Math.min(...data);
    const maxValue = Math.max(...data);
    const distribution = new Map(); // ä½¿ç”¨Mapä¿æŒé¡ºåº
    
    // åˆ›å»ºæ‰€æœ‰å¯èƒ½çš„bin
    for (let binStart = minValue; binStart <= maxValue; binStart += binSize) {
        const binKey = `${binStart}-${binStart + binSize - 1}`;
        distribution.set(binKey, 0);
    }

    // å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„
    data.forEach(value => {
        const binIndex = Math.floor((value - minValue) / binSize);
        const binStart = minValue + binIndex * binSize;
        const binKey = `${binStart}-${binStart + binSize - 1}`;
        distribution.set(binKey, distribution.get(binKey) + 1);
    });

    // å‡†å¤‡å›¾è¡¨æ•°æ®
    const labels = Array.from(distribution.keys());
    const values = Array.from(distribution.values());
    const percentages = values.map(v => (v / data.length * 100).toFixed(1));

    // é”€æ¯æ—§å›¾è¡¨
    const ctx = document.getElementById(elementId);
    const existingChart = Chart.getChart(ctx);
    if (existingChart) {
        existingChart.destroy();
    }

    // åˆ›å»ºæ–°å›¾è¡¨
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'å‡ºç°é¢‘ç‡ (%)',
                data: percentages,
                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'ç™¾åˆ†æ¯” (%)'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: title
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `é¢‘ç‡: ${context.parsed.y}%`;
                        }
                    }
                }
            }
        }
    });
}

function drawStarsReachedChart(elementId, data) {
    const total = data.reduce((a, b) => a + b, 0);
    const percentages = data.map(count => (count / total * 100).toFixed(1));
    const labels = data.map((_, i) => `${i}æ˜Ÿ`);

    // é”€æ¯æ—§å›¾è¡¨
    const ctx = document.getElementById(elementId);
    const existingChart = Chart.getChart(ctx);
    if (existingChart) {
        existingChart.destroy();
    }

    // åˆ›å»ºæ–°å›¾è¡¨
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'åˆ°è¾¾é¢‘ç‡ (%)',
                data: percentages,
                backgroundColor: 'rgba(75, 192, 192, 0.5)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'ç™¾åˆ†æ¯” (%)'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'æ˜Ÿçº§'
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
}
function drawCumulativeChart(elementId, data) {
    // å¯¹æ•°æ®è¿›è¡Œæ’åº
    const sortedData = [...data].sort((a, b) => a - b);
    
    // è®¡ç®—ç´¯è®¡æ¦‚ç‡
    const cumulativeData = [];
    const labels = [];
    const totalCount = sortedData.length;
    
    // è®¡ç®—å…³é”®ç™¾åˆ†ä½æ•°
    const median = sortedData[Math.floor(totalCount * 0.5)];
    const percentile90 = sortedData[Math.floor(totalCount * 0.9)];
    const percentile95 = sortedData[Math.floor(totalCount * 0.95)];
    
    // æ›´æ–°æ˜¾ç¤º
    document.getElementById('median').textContent = median;
    document.getElementById('percentile90').textContent = percentile90;
    document.getElementById('percentile95').textContent = percentile95;

    // åˆ›å»ºç´¯è®¡æ¦‚ç‡æ•°æ®ç‚¹
    let currentCount = 0;
    let lastValue = -1;
    sortedData.forEach((value, index) => {
        if (value !== lastValue) {
            if (lastValue !== -1) {
                labels.push(lastValue);
                cumulativeData.push((currentCount / totalCount * 100).toFixed(2));
            }
            lastValue = value;
        }
        currentCount++;
    });
    // æ·»åŠ æœ€åä¸€ä¸ªç‚¹
    labels.push(lastValue);
    cumulativeData.push((currentCount / totalCount * 100).toFixed(2));

    // é”€æ¯æ—§å›¾è¡¨
    const ctx = document.getElementById(elementId);
    const existingChart = Chart.getChart(ctx);
    if (existingChart) {
        existingChart.destroy();
    }

    // åˆ›å»ºæ–°å›¾è¡¨
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'ç´¯è®¡æ¦‚ç‡ (%)',
                data: cumulativeData,
                borderColor: 'rgba(255, 99, 132, 1)',
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                fill: true,
                tension: 0.1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'ç´¯è®¡æ¦‚ç‡ (%)'
                    },
                    max: 100
                },
                x: {
                    title: {
                        display: true,
                        text: 'å°è¯•æ¬¡æ•°'
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `å®Œæˆæ¦‚ç‡: ${context.parsed.y}%`;
                        }
                    }
                }
            }
        }
    });
}


// æ·»åŠ æŒ‰é’®äº‹ä»¶ç›‘å¬
document.getElementById('statsButton').addEventListener('click', runStatisticalSimulation);
		function renderProbabilityTable() {
			const maxStars = parseInt(document.getElementById('maxStars').value);
			const data = probabilityData[maxStars];
			
			let html = `
				<table class="probability-table">
					<tr>
						<th style="width: 20%">å¼ºåŒ–é˜¶æ®µ</th>
						<th style="width: 20%">æˆåŠŸç‡</th>
						<th style="width: 20%">å¤±è´¥ç‡</th>
						<th style="width: 20%">æŸåç‡</th>
						<th style="width: 20%">å¤±è´¥æ‰æ˜Ÿ</th>
					</tr>
			`;

			data.forEach(item => {
				html += `
					<tr>
						<td>${item.stars}</td>
						<td class="success-rate">${item.success}%</td>
						<td class="failure-rate">${item.failure}%</td>
						<td class="destroy-rate">${item.destroy}%</td>
						<td>${item.drops ? 'âœ…' : 'âŒ'}</td>
					</tr>
				`;
			});

			html += `</table>`;
			document.getElementById('probabilityTable').innerHTML = html;
		}

		// åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
		document.getElementById('maxStars').addEventListener('change', renderProbabilityTable);

		// åˆå§‹æ¸²æŸ“
		renderProbabilityTable();
        updateCurrentProbDisplay();
    </script>
</body>
</html>
